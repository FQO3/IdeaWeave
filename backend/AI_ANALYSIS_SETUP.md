# AI 分析功能设置指南

## 功能概述

当用户提交新笔记时，系统会自动调用 DeepSeek API 进行分析，包括：

1. **标题生成** - 生成不超过10个字的标题
2. **分类识别** - 严格三分类：
   - `todo`: 具体的待办事项、任务
   - `plan`: 新的规划、项目想法  
   - `inspiration`: 规划下的灵感、想法
3. **关联分析** - 仅对非todo类笔记，找出与现有笔记的关联

## 环境配置

### 1. 获取 DeepSeek API 密钥

1. 访问 [DeepSeek 开放平台](https://platform.deepseek.com/)
2. 注册账号并获取 API 密钥
3. 将密钥添加到环境变量

### 2. 配置环境变量

在 `backend/.env` 文件中添加：

```env
DEEPSEEK_API_KEY=your_deepseek_api_key_here
```

### 3. 数据库迁移

运行数据库迁移以添加AI分析字段：

```bash
# 在 backend 目录下
pnpm db:migrate
```

## 功能特性

### 自动分类
- **todo**: 包含"待办"、"任务"、"需要"、"应该"等关键词
- **plan**: 包含"计划"、"规划"、"项目"、"目标"等关键词  
- **inspiration**: 其他所有笔记

### 智能关联
- 仅对 `plan` 和 `inspiration` 类笔记进行关联分析
- 关联强度范围：0.1-1.0
- 最多关联3个现有笔记

### 容错机制
- 如果API调用失败，使用启发式规则进行基础分类
- 如果无API密钥，使用默认分析逻辑

## API 响应格式

```typescript
{
  "title": "学习计划",
  "category": "plan",
  "relatedIdeas": [
    {
      "ideaId": "uuid-string",
      "reason": "都是关于学习的内容",
      "strength": 0.8
    }
  ]
}
```

## 前端显示

- **标题**: 显示在笔记卡片顶部
- **分类标签**: 不同颜色标识不同分类
- **关联笔记**: 显示关联的笔记ID和原因

## 注意事项

1. 所有关联分析严格限制在当前用户的笔记范围内
2. API调用有频率限制，请合理使用
3. 分类结果仅供参考，用户可手动调整
4. 关联强度基于语义相似度计算